<!DOCTYPE html>

<!--
Modified from example file by @mbostock (https://github.com/mbostock)
Check this link for original example: http://bl.ocks.org/d3noob/5193723
-->

<meta charset="utf-8">
<style>
path {
  stroke: grey;
  stroke-width: 0.5px;
  fill: white;
}
header {
	font-family: "PT Sans", sans-serif;
	font-size: 12px;
	}
body {
	font-family: "PT Sans", sans-serif;
	font-size: 13px;
	}
</style>

<header>
  By <a href="https://github.com/mostaphaRoudsari" rel="author">Mostapha Roudsari</a>
  - Inspired by <a href="https://github.com/mbostock" rel="author">Mike Bostock</a> 's
  <a href="http://bl.ocks.org/d3noob/5193723" rel="link">example</a>
  <aside>Dec 21, 2014</aside>
</header>

<h1>EnergyPlus Weather Data Map</h1>

<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v0.min.js"></script>


<div id="wrapper" class="map" style="width:100%;height:500px">
<script>
var width = 1280,
    height = 500;

var projection = d3.geo.mercator()
    .center([-25, 15])
    .scale(300)
    .rotate([-5,0]);

var svg = d3.select('#wrapper').append("svg")
    .attr("width", width)
    .attr("height", height);

var path = d3.geo.path()
    .projection(projection);

var g = svg.append("g");

// circle colors based on data source
var circle_colors = {
					"CSWD" : "blue",
					"CWEC" : "orange",
					"CZ01RV2" : "green",
					"CZ02RV2" : "green",
					"CZ03RV2" : "green",
					"CZ04RV2" : "green",
					"CZ05RV2" : "green",
					"CZ06RV2" : "green",
					"CZ07RV2" : "green",
					"CZ08RV2" : "green",
					"CZ09RV2" : "green",
					"CZ10RV2" : "green",
					"CZ11RV2" : "green",
					"CZ12RV2" : "green",
					"CZ13RV2" : "green",
					"CZ14RV2" : "green",
					"CZ15RV2" : "green",
					"CZ16RV2" : "green",
					"CityUHK" : "green",
					"ETMY" : "grey",
					"IGDG" : "grey",
					"IMGW" : "grey",
					"INETI" : "grey",
					"ISHRAE" : "grey",
					"ITMY" : "grey",
					"IWEC" : "brown",
					"KISR" : "grey",
					"MSI" : "grey",
					"NIWA" : "grey",
					"RMY" : "grey",
					"SWEC" : "grey",
					"SWERA" : "red",
					"TMY" : "pink",
					"TMY2" : "yellow",
					"TMY3" : "#e6550d"
					};
					
// load and display the World
d3.json("./json/world-110m2.json", function(error, topology) {
//d3.json("https://dl.dropboxusercontent.com/u/16228160/world-110m2.json", function(error, topology) {

// load and display the cities
d3.csv("./data/epw_weather_data.csv", function(error, data) {
// d3.csv("https://dl.dropboxusercontent.com/u/16228160/epw_weather_data.csv", function(error, data) {
    
    g.selectAll("text")
       .data(data)
       .enter()
     .append("text") // append text
       .attr("x", function(d) {
               return projection([d.lon, d.lat])[0];
       })
       .attr("y", function(d) {
               return projection([d.lon, d.lat])[1];
       })
       .attr("dy", -1.2) // set y position of bottom of text
      .style("fill", "black") // fill the text with the colour black
	  .style("font-size", "1px")
      .attr("text-anchor", "middle") // set anchor y justification
      .text(function(d) {return d.station_name;}); // define the text to display

	  	// add circles
	g.selectAll("circle")
       .data(data)
       .enter()
       .append("a")
		.attr("xlink:href", function(d){return d.http_link;})
     .append("circle")
       .attr("cx", function(d) {
               return projection([d.lon, d.lat])[0];
       })
       .attr("cy", function(d) {
               return projection([d.lon, d.lat])[1];
       })
	   .on("click", function(d){ window.open(d.http_link); }) // this is duplication with "xlink"!
       .attr("r", .6)
       .style("stroke", function(d) { return circle_colors[d.data_source];})
	   .style("fill", "white")
	   .style("opacity", .8)
	   .style("stroke-width", .3);
});

	// add countries
	g.selectAll("path")
		  .data(topojson.object(topology, topology.objects.countries)
			  .geometries)
		.enter()
		  .append("path")
		  .attr("d", path)
});


// zoom and pan
var zoom = d3.behavior.zoom()
    .on("zoom",function() {
        g.attr("transform","translate("+ 
            d3.event.translate.join(",")+")scale("+d3.event.scale+")");
        g.selectAll("circle")
            .attr("d", path.projection(projection));
        g.selectAll("path")  
            .attr("d", path.projection(projection)); 

  });

svg.call(zoom)

</script>
</div>
<div id="description" class="description" style="width:100%;height:300px">
<br><br>
Zoom and pan to see available weather data stations. You can download the files by clicking on the circles. 
Files are hosted by <a href="http://apps1.eere.energy.gov/buildings/energyplus/weatherdata_about.cfm" rel="link">Department of Energy</a>.
<br><br>
Weather data information is parsed by <a href="https://github.com/mostaphaRoudsari/ladybug" rel="link">Ladybug</a> || 
Source code: <a href="https://github.com/mostaphaRoudsari/epwmap" rel="link">Github</a> ||  
This page is using <a href="https://github.com/mbostock/D3" rel="link">D3</a> library. Click <a href="http://d3js.org/" rel="link">here</a> for more examples.
</div>

</body>
</html>
